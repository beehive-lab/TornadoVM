{"version":3,"sources":["../src/index.js"],"names":["tinyColor","throwError","isNodePattern","applyKernel","im","kernel","x","y","value","size","length","kx","ky","idx","getPixelIndex","bitmap","data","isDef","v","greyscale","cb","scanQuiet","width","height","grey","parseInt","call","colorFn","actions","Array","isArray","originalScope","clr","r","g","b","colorModifier","i","amount","c","toRgb","Math","max","min","forEach","action","apply","mix","params","clr2","fn","brightness","val","contrast","adjust","pow","posterize","n","floor","grayscale","opacity","f","sepia","red","green","blue","fade","convolution","edgeHandling","constructor","EDGE_EXTEND","newData","Buffer","from","kRows","kCols","rowEnd","colEnd","rowIni","colIni","weight","rSum","gSum","bSum","ri","gi","bi","xi","yi","idxi","row","col","opaque","pixelate","w","h","source","cloneQuiet","xx","yx","convolute","ksize","color","colour"],"mappings":"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","sourcesContent":["import tinyColor from 'tinycolor2';\nimport { throwError, isNodePattern } from '@jimp/utils';\n\nfunction applyKernel(im, kernel, x, y) {\n  const value = [0, 0, 0];\n  const size = (kernel.length - 1) / 2;\n\n  for (let kx = 0; kx < kernel.length; kx += 1) {\n    for (let ky = 0; ky < kernel[kx].length; ky += 1) {\n      const idx = im.getPixelIndex(x + kx - size, y + ky - size);\n\n      value[0] += im.bitmap.data[idx] * kernel[kx][ky];\n      value[1] += im.bitmap.data[idx + 1] * kernel[kx][ky];\n      value[2] += im.bitmap.data[idx + 2] * kernel[kx][ky];\n    }\n  }\n  return value;\n}\n\nconst isDef = v => typeof v !== 'undefined' && v !== null;\n\nfunction greyscale(cb) {\n  this.scanQuiet(0, 0, this.bitmap.width, this.bitmap.height, function(\n    x,\n    y,\n    idx\n  ) {\n    const grey = parseInt(\n      0.2126 * this.bitmap.data[idx] +\n        0.7152 * this.bitmap.data[idx + 1] +\n        0.0722 * this.bitmap.data[idx + 2],\n      10\n    );\n\n    this.bitmap.data[idx] = grey;\n    this.bitmap.data[idx + 1] = grey;\n    this.bitmap.data[idx + 2] = grey;\n  });\n\n  if (isNodePattern(cb)) {\n    cb.call(this, null, this);\n  }\n\n  return this;\n}\n\nfunction colorFn(actions, cb) {\n  if (!actions || !Array.isArray(actions)) {\n    return throwError.call(this, 'actions must be an array', cb);\n  }\n\n  const originalScope = this;\n  this.scanQuiet(0, 0, this.bitmap.width, this.bitmap.height, function(\n    x,\n    y,\n    idx\n  ) {\n    let clr = tinyColor({\n      r: this.bitmap.data[idx],\n      g: this.bitmap.data[idx + 1],\n      b: this.bitmap.data[idx + 2]\n    });\n\n    const colorModifier = function(i, amount) {\n      const c = clr.toRgb();\n      c[i] = Math.max(0, Math.min(c[i] + amount, 255));\n      return tinyColor(c);\n    };\n\n    actions.forEach(action => {\n      if (action.apply === 'mix') {\n        clr = tinyColor.mix(clr, action.params[0], action.params[1]);\n      } else if (action.apply === 'tint') {\n        clr = tinyColor.mix(clr, 'white', action.params[0]);\n      } else if (action.apply === 'shade') {\n        clr = tinyColor.mix(clr, 'black', action.params[0]);\n      } else if (action.apply === 'xor') {\n        const clr2 = tinyColor(action.params[0]).toRgb();\n        clr = clr.toRgb();\n        clr = tinyColor({\n          r: clr.r ^ clr2.r,\n          g: clr.g ^ clr2.g,\n          b: clr.b ^ clr2.b\n        });\n      } else if (action.apply === 'red') {\n        clr = colorModifier('r', action.params[0]);\n      } else if (action.apply === 'green') {\n        clr = colorModifier('g', action.params[0]);\n      } else if (action.apply === 'blue') {\n        clr = colorModifier('b', action.params[0]);\n      } else {\n        if (action.apply === 'hue') {\n          action.apply = 'spin';\n        }\n\n        const fn = clr[action.apply];\n\n        if (!fn) {\n          return throwError.call(\n            originalScope,\n            'action ' + action.apply + ' not supported',\n            cb\n          );\n        }\n\n        clr = fn.apply(clr, action.params);\n      }\n    });\n\n    clr = clr.toRgb();\n    this.bitmap.data[idx] = clr.r;\n    this.bitmap.data[idx + 1] = clr.g;\n    this.bitmap.data[idx + 2] = clr.b;\n  });\n\n  if (isNodePattern(cb)) {\n    cb.call(this, null, this);\n  }\n\n  return this;\n}\n\nexport default () => ({\n  /**\n   * Adjusts the brightness of the image\n   * @param {number} val the amount to adjust the brightness, a number between -1 and +1\n   * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n   * @returns {Jimp }this for chaining of methods\n   */\n  brightness(val, cb) {\n    if (typeof val !== 'number') {\n      return throwError.call(this, 'val must be numbers', cb);\n    }\n\n    if (val < -1 || val > +1) {\n      return throwError.call(\n        this,\n        'val must be a number between -1 and +1',\n        cb\n      );\n    }\n\n    this.scanQuiet(0, 0, this.bitmap.width, this.bitmap.height, function(\n      x,\n      y,\n      idx\n    ) {\n      if (val < 0.0) {\n        this.bitmap.data[idx] = this.bitmap.data[idx] * (1 + val);\n        this.bitmap.data[idx + 1] = this.bitmap.data[idx + 1] * (1 + val);\n        this.bitmap.data[idx + 2] = this.bitmap.data[idx + 2] * (1 + val);\n      } else {\n        this.bitmap.data[idx] =\n          this.bitmap.data[idx] + (255 - this.bitmap.data[idx]) * val;\n        this.bitmap.data[idx + 1] =\n          this.bitmap.data[idx + 1] + (255 - this.bitmap.data[idx + 1]) * val;\n        this.bitmap.data[idx + 2] =\n          this.bitmap.data[idx + 2] + (255 - this.bitmap.data[idx + 2]) * val;\n      }\n    });\n\n    if (isNodePattern(cb)) {\n      cb.call(this, null, this);\n    }\n\n    return this;\n  },\n\n  /**\n   * Adjusts the contrast of the image\n   * @param {number} val the amount to adjust the contrast, a number between -1 and +1\n   * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n   * @returns {Jimp }this for chaining of methods\n   */\n  contrast(val, cb) {\n    if (typeof val !== 'number') {\n      return throwError.call(this, 'val must be numbers', cb);\n    }\n\n    if (val < -1 || val > +1) {\n      return throwError.call(\n        this,\n        'val must be a number between -1 and +1',\n        cb\n      );\n    }\n\n    function adjust(value) {\n      let x;\n\n      if (val < 0) {\n        x = value > 127 ? 1 - value / 255 : value / 255;\n\n        if (x < 0) {\n          x = 0;\n        }\n\n        x = 0.5 * Math.pow(x * 2, 1 + val);\n\n        return value > 127 ? (1.0 - x) * 255 : x * 255;\n      }\n\n      x = value > 127 ? 1 - value / 255 : value / 255;\n\n      if (x < 0) {\n        x = 0;\n      }\n\n      x = 0.5 * Math.pow(2 * x, val === 1 ? 127 : 1 / (1 - val));\n\n      return value > 127 ? (1 - x) * 255 : x * 255;\n    }\n\n    this.scanQuiet(0, 0, this.bitmap.width, this.bitmap.height, function(\n      x,\n      y,\n      idx\n    ) {\n      this.bitmap.data[idx] = adjust(this.bitmap.data[idx]);\n      this.bitmap.data[idx + 1] = adjust(this.bitmap.data[idx + 1]);\n      this.bitmap.data[idx + 2] = adjust(this.bitmap.data[idx + 2]);\n    });\n\n    if (isNodePattern(cb)) {\n      cb.call(this, null, this);\n    }\n\n    return this;\n  },\n\n  /**\n   * Apply a posterize effect\n   * @param {number} n the amount to adjust the contrast, minimum threshold is two\n   * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n   * @returns {Jimp }this for chaining of methods\n   */\n  posterize(n, cb) {\n    if (typeof n !== 'number') {\n      return throwError.call(this, 'n must be numbers', cb);\n    }\n\n    if (n < 2) {\n      n = 2;\n    } // minimum of 2 levels\n\n    this.scanQuiet(0, 0, this.bitmap.width, this.bitmap.height, function(\n      x,\n      y,\n      idx\n    ) {\n      this.bitmap.data[idx] =\n        (Math.floor((this.bitmap.data[idx] / 255) * (n - 1)) / (n - 1)) * 255;\n      this.bitmap.data[idx + 1] =\n        (Math.floor((this.bitmap.data[idx + 1] / 255) * (n - 1)) / (n - 1)) *\n        255;\n      this.bitmap.data[idx + 2] =\n        (Math.floor((this.bitmap.data[idx + 2] / 255) * (n - 1)) / (n - 1)) *\n        255;\n    });\n\n    if (isNodePattern(cb)) {\n      cb.call(this, null, this);\n    }\n\n    return this;\n  },\n\n  /**\n   * Removes colour from the image using ITU Rec 709 luminance values\n   * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n   * @returns {Jimp }this for chaining of methods\n   */\n  greyscale,\n\n  // Alias of greyscale for our American friends\n  grayscale: greyscale,\n\n  /**\n   * Multiplies the opacity of each pixel by a factor between 0 and 1\n   * @param {number} f A number, the factor by which to multiply the opacity of each pixel\n   * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n   * @returns {Jimp }this for chaining of methods\n   */\n  opacity(f, cb) {\n    if (typeof f !== 'number')\n      return throwError.call(this, 'f must be a number', cb);\n    if (f < 0 || f > 1)\n      return throwError.call(this, 'f must be a number from 0 to 1', cb);\n\n    this.scanQuiet(0, 0, this.bitmap.width, this.bitmap.height, function(\n      x,\n      y,\n      idx\n    ) {\n      const v = this.bitmap.data[idx + 3] * f;\n      this.bitmap.data[idx + 3] = v;\n    });\n\n    if (isNodePattern(cb)) {\n      cb.call(this, null, this);\n    }\n\n    return this;\n  },\n\n  /**\n   * Applies a sepia tone to the image\n   * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n   * @returns {Jimp }this for chaining of methods\n   */\n  sepia(cb) {\n    this.scanQuiet(0, 0, this.bitmap.width, this.bitmap.height, function(\n      x,\n      y,\n      idx\n    ) {\n      let red = this.bitmap.data[idx];\n      let green = this.bitmap.data[idx + 1];\n      let blue = this.bitmap.data[idx + 2];\n\n      red = red * 0.393 + green * 0.769 + blue * 0.189;\n      green = red * 0.349 + green * 0.686 + blue * 0.168;\n      blue = red * 0.272 + green * 0.534 + blue * 0.131;\n\n      this.bitmap.data[idx] = red < 255 ? red : 255;\n      this.bitmap.data[idx + 1] = green < 255 ? green : 255;\n      this.bitmap.data[idx + 2] = blue < 255 ? blue : 255;\n    });\n\n    if (isNodePattern(cb)) {\n      cb.call(this, null, this);\n    }\n\n    return this;\n  },\n\n  /**\n   * Fades each pixel by a factor between 0 and 1\n   * @param {number} f A number from 0 to 1. 0 will haven no effect. 1 will turn the image completely transparent.\n   * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n   * @returns {Jimp }this for chaining of methods\n   */\n  fade(f, cb) {\n    if (typeof f !== 'number') {\n      return throwError.call(this, 'f must be a number', cb);\n    }\n\n    if (f < 0 || f > 1) {\n      return throwError.call(this, 'f must be a number from 0 to 1', cb);\n    }\n\n    // this method is an alternative to opacity (which may be deprecated)\n    this.opacity(1 - f);\n\n    if (isNodePattern(cb)) {\n      cb.call(this, null, this);\n    }\n\n    return this;\n  },\n\n  /**\n   * Adds each element of the image to its local neighbors, weighted by the kernel\n   * @param {array} kernel a matrix to weight the neighbors sum\n   * @param {string} edgeHandling (optional) define how to sum pixels from outside the border\n   * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n   * @returns {Jimp }this for chaining of methods\n   */\n  convolution(kernel, edgeHandling, cb) {\n    if (typeof edgeHandling === 'function' && typeof cb === 'undefined') {\n      cb = edgeHandling;\n      edgeHandling = null;\n    }\n\n    if (!edgeHandling) {\n      edgeHandling = this.constructor.EDGE_EXTEND;\n    }\n\n    const newData = Buffer.from(this.bitmap.data);\n    const kRows = kernel.length;\n    const kCols = kernel[0].length;\n    const rowEnd = Math.floor(kRows / 2);\n    const colEnd = Math.floor(kCols / 2);\n    const rowIni = -rowEnd;\n    const colIni = -colEnd;\n\n    let weight;\n    let rSum;\n    let gSum;\n    let bSum;\n    let ri;\n    let gi;\n    let bi;\n    let xi;\n    let yi;\n    let idxi;\n\n    this.scanQuiet(0, 0, this.bitmap.width, this.bitmap.height, function(\n      x,\n      y,\n      idx\n    ) {\n      bSum = 0;\n      gSum = 0;\n      rSum = 0;\n\n      for (let row = rowIni; row <= rowEnd; row++) {\n        for (let col = colIni; col <= colEnd; col++) {\n          xi = x + col;\n          yi = y + row;\n          weight = kernel[row + rowEnd][col + colEnd];\n          idxi = this.getPixelIndex(xi, yi, edgeHandling);\n\n          if (idxi === -1) {\n            bi = 0;\n            gi = 0;\n            ri = 0;\n          } else {\n            ri = this.bitmap.data[idxi + 0];\n            gi = this.bitmap.data[idxi + 1];\n            bi = this.bitmap.data[idxi + 2];\n          }\n\n          rSum += weight * ri;\n          gSum += weight * gi;\n          bSum += weight * bi;\n        }\n      }\n\n      if (rSum < 0) {\n        rSum = 0;\n      }\n\n      if (gSum < 0) {\n        gSum = 0;\n      }\n\n      if (bSum < 0) {\n        bSum = 0;\n      }\n\n      if (rSum > 255) {\n        rSum = 255;\n      }\n\n      if (gSum > 255) {\n        gSum = 255;\n      }\n\n      if (bSum > 255) {\n        bSum = 255;\n      }\n\n      newData[idx + 0] = rSum;\n      newData[idx + 1] = gSum;\n      newData[idx + 2] = bSum;\n    });\n\n    this.bitmap.data = newData;\n\n    if (isNodePattern(cb)) {\n      cb.call(this, null, this);\n    }\n\n    return this;\n  },\n\n  /**\n   * Set the alpha channel on every pixel to fully opaque\n   * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n   * @returns {Jimp }this for chaining of methods\n   */\n  opaque(cb) {\n    this.scanQuiet(0, 0, this.bitmap.width, this.bitmap.height, function(\n      x,\n      y,\n      idx\n    ) {\n      this.bitmap.data[idx + 3] = 255;\n    });\n\n    if (isNodePattern(cb)) {\n      cb.call(this, null, this);\n    }\n\n    return this;\n  },\n\n  /**\n   * Pixelates the image or a region\n   * @param {number} size the size of the pixels\n   * @param {number} x (optional) the x position of the region to pixelate\n   * @param {number} y (optional) the y position of the region to pixelate\n   * @param {number} w (optional) the width of the region to pixelate\n   * @param {number} h (optional) the height of the region to pixelate\n   * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n   * @returns {Jimp }this for chaining of methods\n   */\n  pixelate(size, x, y, w, h, cb) {\n    if (typeof x === 'function') {\n      cb = x;\n      h = null;\n      w = null;\n      y = null;\n      x = null;\n    } else {\n      if (typeof size !== 'number') {\n        return throwError.call(this, 'size must be a number', cb);\n      }\n\n      if (isDef(x) && typeof x !== 'number') {\n        return throwError.call(this, 'x must be a number', cb);\n      }\n\n      if (isDef(y) && typeof y !== 'number') {\n        return throwError.call(this, 'y must be a number', cb);\n      }\n\n      if (isDef(w) && typeof w !== 'number') {\n        return throwError.call(this, 'w must be a number', cb);\n      }\n\n      if (isDef(h) && typeof h !== 'number') {\n        return throwError.call(this, 'h must be a number', cb);\n      }\n    }\n\n    const kernel = [\n      [1 / 16, 2 / 16, 1 / 16],\n      [2 / 16, 4 / 16, 2 / 16],\n      [1 / 16, 2 / 16, 1 / 16]\n    ];\n\n    x = x || 0;\n    y = y || 0;\n    w = isDef(w) ? x : this.bitmap.width - x;\n    h = isDef(h) ? h : this.bitmap.height - y;\n\n    const source = this.cloneQuiet();\n\n    this.scanQuiet(x, y, w, h, function(xx, yx, idx) {\n      xx = size * Math.floor(xx / size);\n      yx = size * Math.floor(yx / size);\n\n      const value = applyKernel(source, kernel, xx, yx);\n\n      this.bitmap.data[idx] = value[0];\n      this.bitmap.data[idx + 1] = value[1];\n      this.bitmap.data[idx + 2] = value[2];\n    });\n\n    if (isNodePattern(cb)) {\n      cb.call(this, null, this);\n    }\n\n    return this;\n  },\n\n  /**\n   * Applies a convolution kernel to the image or a region\n   * @param {array} kernel the convolution kernel\n   * @param {number} x (optional) the x position of the region to apply convolution to\n   * @param {number} y (optional) the y position of the region to apply convolution to\n   * @param {number} w (optional) the width of the region to apply convolution to\n   * @param {number} h (optional) the height of the region to apply convolution to\n   * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n   * @returns {Jimp }this for chaining of methods\n   */\n  convolute(kernel, x, y, w, h, cb) {\n    if (!Array.isArray(kernel))\n      return throwError.call(this, 'the kernel must be an array', cb);\n\n    if (typeof x === 'function') {\n      cb = x;\n      x = null;\n      y = null;\n      w = null;\n      h = null;\n    } else {\n      if (isDef(x) && typeof x !== 'number') {\n        return throwError.call(this, 'x must be a number', cb);\n      }\n\n      if (isDef(y) && typeof y !== 'number') {\n        return throwError.call(this, 'y must be a number', cb);\n      }\n\n      if (isDef(w) && typeof w !== 'number') {\n        return throwError.call(this, 'w must be a number', cb);\n      }\n\n      if (isDef(h) && typeof h !== 'number') {\n        return throwError.call(this, 'h must be a number', cb);\n      }\n    }\n\n    const ksize = (kernel.length - 1) / 2;\n\n    x = isDef(x) ? x : ksize;\n    y = isDef(y) ? y : ksize;\n    w = isDef(w) ? w : this.bitmap.width - x;\n    h = isDef(h) ? h : this.bitmap.height - y;\n\n    const source = this.cloneQuiet();\n\n    this.scanQuiet(x, y, w, h, function(xx, yx, idx) {\n      const value = applyKernel(source, kernel, xx, yx);\n\n      this.bitmap.data[idx] = value[0];\n      this.bitmap.data[idx + 1] = value[1];\n      this.bitmap.data[idx + 2] = value[2];\n    });\n\n    if (isNodePattern(cb)) {\n      cb.call(this, null, this);\n    }\n\n    return this;\n  },\n\n  /**\n   * Apply multiple color modification rules\n   * @param {array} actions list of color modification rules, in following format: { apply: '<rule-name>', params: [ <rule-parameters> ]  }\n   * @param {function(Error, Jimp)} cb (optional) a callback for when complete\n   * @returns {Jimp }this for chaining of methods\n   */\n  color: colorFn,\n  colour: colorFn\n});\n"],"file":"index.js"}